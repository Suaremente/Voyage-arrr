<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Day-by-Day Itinerary with Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
    <style>
      header {
        text-align: center;
      }
      html, body {
        height: 100%;
        margin: 0;
      }
      body {
        background-image: url('https://voyage-arrr.vercel.app/backgrounds/vecteezy_ocean-wave-vector-background-sea-water-landscape_23865024.jpg');
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      p {
        background-color: rgb(34, 122, 209);
        color: rgb(245, 255, 250);
        border-radius: 5px;
        box-shadow: 0 0 10px rgb(255, 215, 0);
        width: 60vw;
        max-width: 700px;
        min-width: 350px;
        margin: 0 auto;
        padding: 15px 15px 25px 15px;
      }
      #map {
        width: 100%;
        height: 35vh;
        max-width: 800px;
        margin: 20px auto;
        border-radius: 10px;
        position: relative;
      }
      .search-container {
        position: absolute;
        top: 10px;
        left: 10px;
        background: white;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 300px;
        display: flex;
        flex-direction: column;
        z-index: 1;
      }
      .search-container input {
        padding: 8px;
        margin-bottom: 10px;
      }
      .search-container button {
        padding: 8px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
      }
      .suggestions {
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
      }
      .suggestions div {
        padding: 8px;
        cursor: pointer;
      }
      .suggestions div:hover {
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 style="color:white">Here is your day-by-day itinerary</h1>
    </header>

    <p>Insert info here</p>

    <!-- Map and Search Container -->
    <div id="map">
      <div class="search-container">
        <input type="text" id="location-input" placeholder="Enter location" />
        <div class="suggestions" id="suggestions"></div>
        <button id="search-btn">Search</button>
      </div>
    </div>

    <script>
      mapboxgl.accessToken = 'pk.eyJ1Ijoid2lsbGlhbWJ1IiwiYSI6ImNtMXdpeHYxejBuZHUybG9yYnRzZmJxeDMifQ.CvpftxGSqM7tF0ZbU24v0A';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-80.191788, 25.761681], // Miami default center
        zoom: 12
      });

      let currentMarker = null;

      function searchLocation(location) {
        const accessToken = 'pk.eyJ1Ijoid2lsbGlhbWJ1IiwiYSI6ImNtMXdpeHYxejBuZHUybG9yYnRzZmJxeDMifQ.CvpftxGSqM7tF0ZbU24v0A';
        const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(location)}.json?access_token=${accessToken}`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.features && data.features.length > 0) {
              const coordinates = data.features[0].geometry.coordinates;
              map.flyTo({
                center: coordinates,
                zoom: 14,
                essential: true
              });
              if (currentMarker) {
                currentMarker.remove();
              }
              currentMarker = new mapboxgl.Marker()
                .setLngLat(coordinates)
                .addTo(map);
            } else {
              alert('Location not found. Please try a different search.');
            }
          })
          .catch(error => {
            console.error('Error with geocoding:', error);
            alert('There was an error processing your search. Please try again.');
          });
      }

      function fetchSuggestions(query) {
        const accessToken = 'pk.eyJ1Ijoid2lsbGlhbWJ1IiwiYSI6ImNtMXdpeHYxejBuZHUybG9yYnRzZmJxeDMifQ.CvpftxGSqM7tF0ZbU24v0A';
        const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${accessToken}&autocomplete=true&limit=5`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            if (data.features && data.features.length > 0) {
              data.features.forEach(feature => {
                const suggestion = document.createElement('div');
                suggestion.textContent = feature.place_name;
                suggestion.addEventListener('click', () => {
                  searchLocation(feature.place_name);
                  document.getElementById('location-input').value = feature.place_name;
                  suggestionsDiv.innerHTML = '';
                });
                suggestionsDiv.appendChild(suggestion);
              });
            }
          })
          .catch(error => {
            console.error('Error fetching suggestions:', error);
          });
      }

      document.getElementById('location-input').addEventListener('input', function () {
        const query = this.value;
        if (query.length > 2) {
          fetchSuggestions(query);
        } else {
          document.getElementById('suggestions').innerHTML = '';
        }
      });

      document.getElementById('search-btn').addEventListener('click', function () {
        const location = document.getElementById('location-input').value;
        searchLocation(location);
      });

      document.getElementById('location-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          const location = document.getElementById('location-input').value;
          searchLocation(location);
        }
      });
    </script>
  </body>
</html>
